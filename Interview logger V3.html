<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Interview Logger</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --bg: #f8f8f8;
            --text: #000;
            --table-header: #eee;
        }
        body.dark {
            --bg: #121212;
            --text: #fff;
            --table-header: #1e1e1e;
        }
        body {
            font-family: Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            transition: background 0.3s, color 0.3s;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        header, .controls, .mobile-buttons, .legend {
            padding: 10px 20px;
            background: var(--bg);
            z-index: 2;
        }
        main {
            flex-grow: 1;
            overflow-y: auto;
            padding: 0 20px 20px 20px;
        }
        textarea, select, button, input {
            padding: 10px;
            margin-top: 10px;
            box-sizing: border-box;
        }
        button { margin-right: 10px; }
        #noteInput, #speakerSelect, #newSpeaker { width: 100%; }
        .controls button { padding: 10px 20px; width: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        td, th { border: 1px solid #ccc; padding: 8px; }
        #logTable th { background: var(--table-header); }
        td.action-cell { width: 40px; text-align: center; }
	td.time {width:40px;}
	td.speaker {width:175px;}
        td.action-cell button { width: 25px; height: 25px; padding: 0; text-align: center; font-weight: bold; }
        .top-right { position: absolute; top: 20px; right: 20px; }
        .bottom-right { position: fixed; bottom: 20px; right: 20px; z-index: 5;}
        .mobile-buttons { display: none; margin-top: 10px; }
        @media (max-width: 768px) {
            .mobile-buttons { display: flex; justify-content: space-between; gap: 10px; }
            .mobile-buttons button { flex: 1; padding: 15px; font-size: 1em; width: 33%; }
            .legend { display: none; }
            .bottom-right { top: 80px; right: 30px; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Interview Logger</h1>
        <div id="clockDisplay" style="font-size: 1.2em; margin-bottom: 10px;"></div>
        <div class="top-right">
            <button onclick="resetLog()">Reset All</button>
            <button onclick="window.open('https://editingtools.io/marker/', '_blank')">Open EditingTools</button>
        </div>
        <select id="speakerSelect">
            <option value="">Select Speaker</option>
        </select>
        <input type="text" id="newSpeaker" placeholder="Add speaker name and press Enter">
        <textarea id="noteInput" placeholder="Type your note here..."></textarea>
        <div class="controls">
            <button onclick="exportCSV()">Export to CSV</button>
        </div>
        <div class="mobile-buttons">
            <button onclick="addNote('Great', 'Yellow')">Great</button>
            <button onclick="addNote('Good', 'Green')">Good</button>
            <button onclick="addNote('Bad', 'Red')">Bad</button>
        </div>
    </header>

    <main>
        <table id="logTable">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Speaker</th>
                    <th>Note</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </main>

    <div class="legend">
        <strong>Shortcuts:</strong>
        <ul>
            <li><strong>+</strong> Add "Good" marker (Green)</li>
            <li><strong>-</strong> Add "Bad" marker (Red)</li>
            <li><strong>*</strong> Add "Great" marker (Yellow)</li><br>
            <li><strong>Enter</strong>: Add note (when focused on text field)</li>
	    <li><strong>Double click note</strong>: Edit note in table</li>
        </ul>
	<h5>Made by Gurb</h5>
    </div>

    <div class="bottom-right">
        <label style="cursor:pointer;"><input type="checkbox" id="modeToggle"> Dark Mode</label>
    </div>

    <script>
        let log = JSON.parse(localStorage.getItem("logData")) || [];

        function updateClock() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('clockDisplay').innerText = `Current Time: ${h}:${m}:${s}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        function getCurrentTimecode() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');
            const f = "00";
            return `${h}:${m}:${s}:${f}`;
        }

        function addNote(text = null, color = 'Blue') {
            const note = text || document.getElementById("noteInput").value.trim();
            if (note === "") return;
            const speaker = document.getElementById("speakerSelect").value;
            const timecode = getCurrentTimecode();
            log.push({ time: timecode, note: note, speaker: speaker, color: color });
            updateTable();

            const main = document.querySelector('main');
            main.scrollTop = main.scrollHeight;

            if (!text) document.getElementById("noteInput").value = "";
            localStorage.setItem("logData", JSON.stringify(log));
        }

        function deleteEntry(index) {
            if (confirm("Delete this entry?")) {
                log.splice(index, 1);
                localStorage.setItem("logData", JSON.stringify(log));
                updateTable();
            }
        }

        function editEntry(index, cell) {
            const oldValue = log[index].note;
            const input = document.createElement('input');
            input.type = 'text';
            input.value = oldValue;
            input.style.width = '100%';
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();

            input.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    log[index].note = this.value.trim();
                    localStorage.setItem("logData", JSON.stringify(log));
                    updateTable();
                }
            });

            input.addEventListener('blur', function() {
                log[index].note = this.value.trim();
                localStorage.setItem("logData", JSON.stringify(log));
                updateTable();
            });
        }

        function updateTable() {
            const tbody = document.querySelector("#logTable tbody");
            tbody.innerHTML = "";
            log.forEach((entry, index) => {
                const row = document.createElement("tr");
                const noteCell = document.createElement('td');
                noteCell.textContent = entry.note;
                noteCell.ondblclick = function() { editEntry(index, noteCell); };

                row.innerHTML = `
                    <td class="time">${entry.time}</td>
                    <td class="speaker">${entry.speaker}</td>
                    <td></td>
                    <td class="action-cell"><button onclick="deleteEntry(${index})">X</button></td>
                `;
                row.children[2].replaceWith(noteCell);
                tbody.appendChild(row);
            });
        }
        updateTable();

        function exportCSV() {
            let csv = "Marker Name,Description,Start,Duration,Marker Type,Color\n";
            for (let entry of log) {
                csv += `"${entry.note}","${entry.speaker}",${entry.time},00:00:00:00,Comment,${entry.color}\n`;
            }
            const filename = prompt("Enter a name for your CSV file:", "real_time_markers") || "real_time_markers";
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `${filename}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function resetLog() {
            if (confirm("Are you sure you want to delete all notes?")) {
                log = [];
                localStorage.removeItem("logData");
                updateTable();
            }
        }

        document.addEventListener("keydown", function(event) {
            if (window.innerWidth <= 768) return;
            if (event.target.tagName.toLowerCase() === 'textarea' || event.target.id === 'newSpeaker') return;
            if (event.key === "+") addNote("Good", "Green");
            else if (event.key === "-") addNote("Bad", "Red");
            else if (event.key === "*") addNote("Great", "Yellow");
        });

        document.getElementById("noteInput").addEventListener("keydown", function(event) {
            if (event.key === "Enter" && !event.shiftKey) {
                event.preventDefault();
                addNote();
            }
        });

        document.getElementById("newSpeaker").addEventListener("keydown", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                const name = this.value.trim();
                if (name) {
                    const select = document.getElementById("speakerSelect");
                    const option = document.createElement("option");
                    option.value = name;
                    option.textContent = name;
                    select.appendChild(option);
                    select.value = name;
                    this.value = "";
                }
            }
        });

        const modeToggle = document.getElementById("modeToggle");
        modeToggle.addEventListener("change", function() {
            document.body.classList.toggle("dark", this.checked);
        });
        modeToggle.checked = document.body.classList.contains("dark");
    </script>
</body>
</html>
